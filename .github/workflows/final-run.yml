name: final-run

on:
  workflow_dispatch

jobs:
  run-job:
    runs-on: ubuntu-latest
    container:
      image: bertcarnell/r-bracketr

    name: ${{ matrix.config.name }}

    strategy:
      fail-fast: false
      matrix:
        n_truth_brackets: [100]
        n_adversaries: [5]
        pRate: [3]
        nchildren: [10]
        ngenerations : [5]
        gen_method: [2]
        config:
          - {name: 'Xmax', output_file: 'xmax.csv', start_point: 'Xmax', elite8_team: 'NA'}
          - {name: 'Ymax', output_file: 'ymax.csv', start_point: 'Ymax', elite8_team: 'NA'}
          - {name: 'Gonzaga', output_file: 'gonzaga.csv', start_point: 'Elite8', elite8_team: 'Gonzaga'}

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Knit the Results
        run: |
          Rscript read_brackets.R
          Rscript -e 'rmarkdown::render("src/bracket_optimization.Rmd", params = list(n_truth_brackets = ${{ matrix.n_truth_brackets }}, n_adversaries = ${{ matrix.n_adversaries }}, pRate = ${{ matrix.pRate }}, nchildren = ${{ matrix.nchildren }}, ngenerations = ${{ matrix.ngenerations }}, gen_method = ${{ matrix.gen_method }}, output_file = "${{ matrix.config.output_file }}", start_point = "${{ matrix.config.start_point }}", elite8_team = "${{ matrix.config.elite8_team }}"))'
        shell: bash
        
      - name: Upload
        uses: actions/upload-artifact@v2.2.3
        with:
          path: src/${{ matrix.config.output_file }}
